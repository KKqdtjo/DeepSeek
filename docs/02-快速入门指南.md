# DeepSeek åˆ†å¸ƒå¼éƒ¨ç½²å¿«é€Ÿå…¥é—¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨15åˆ†é’Ÿå†…å®ŒæˆDeepSeekæ¨¡å‹çš„åˆ†å¸ƒå¼éƒ¨ç½²ã€‚

### 1. ç¯å¢ƒå‡†å¤‡

#### 1.1 ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04 LTS æˆ–æ›´é«˜ç‰ˆæœ¬
- **å†…å­˜**: è‡³å°‘16GB RAM (æ¨è32GB)
- **å­˜å‚¨**: è‡³å°‘100GBå¯ç”¨ç©ºé—´
- **GPU**: NVIDIA GPU (å¯é€‰ï¼Œæ¨èRTX 3080æˆ–æ›´é«˜)
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥

#### 1.2 åä¸ºäº‘ECSå®ä¾‹æ¨èé…ç½®

| è§„æ ¼ | CPU | å†…å­˜ | GPU | å­˜å‚¨ | é€‚ç”¨åœºæ™¯ |
|------|-----|------|-----|------|----------|
| åŸºç¡€ç‰ˆ | 4æ ¸ | 16GB | æ—  | 100GB SSD | å¼€å‘æµ‹è¯• |
| æ ‡å‡†ç‰ˆ | 8æ ¸ | 32GB | T4 | 200GB SSD | å°è§„æ¨¡ç”Ÿäº§ |
| é«˜æ€§èƒ½ç‰ˆ | 16æ ¸ | 64GB | V100 | 500GB SSD | å¤§è§„æ¨¡ç”Ÿäº§ |

### 2. ä¸€é”®éƒ¨ç½²

#### 2.1 å…‹éš†é¡¹ç›®

```bash
git clone <é¡¹ç›®åœ°å€>
cd å¤§æ¨¡å‹åˆ†å¸ƒå¼éƒ¨ç½²
```

#### 2.2 ç¯å¢ƒåˆå§‹åŒ–

```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x scripts/*.sh

# è¿è¡Œç¯å¢ƒåˆå§‹åŒ–è„šæœ¬
sudo ./scripts/01-init-environment.sh
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…ï¼š

- Docker å’Œ Docker Compose
- Python 3.8+ å’Œå¿…è¦çš„åŒ…
- NVIDIA Docker (å¦‚æœæ£€æµ‹åˆ°GPU)
- Kubernetes (K3s)

#### 2.3 æ¨¡å‹éƒ¨ç½²

```bash
# éƒ¨ç½²DeepSeekæ¨¡å‹ (æœ¬åœ°Dockeréƒ¨ç½²)
./scripts/02-deploy-model.sh

# æˆ–è€…éƒ¨ç½²åˆ°Kubernetes
./scripts/02-deploy-model.sh --type k8s
```

éƒ¨ç½²è¿‡ç¨‹åŒ…æ‹¬ï¼š

1. ä¸‹è½½DeepSeek-Coderæ¨¡å‹ (çº¦13GB)
2. æ„å»ºDockeré•œåƒ
3. å¯åŠ¨åˆ†å¸ƒå¼æœåŠ¡
4. é…ç½®è´Ÿè½½å‡è¡¡

#### 2.4 éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./scripts/03-monitor-service.sh status

# æ‰§è¡Œå¥åº·æ£€æŸ¥
./scripts/03-monitor-service.sh health

# æµ‹è¯•API
./scripts/03-monitor-service.sh test
```

### 3. æœåŠ¡è®¿é—®

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ç«¯ç‚¹è®¿é—®æœåŠ¡ï¼š

- **ä¸»æœåŠ¡**: <http://localhost/>
- **APIæ–‡æ¡£**: <http://localhost/docs>
- **å¥åº·æ£€æŸ¥**: <http://localhost/health>
- **æŒ‡æ ‡ç›‘æ§**: <http://localhost:9090/metrics>

### 4. API ä½¿ç”¨ç¤ºä¾‹

#### 4.1 ä½¿ç”¨curlæµ‹è¯•

```bash
curl -X POST http://localhost/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "deepseek-coder",
    "messages": [
      {
        "role": "user",
        "content": "è¯·å†™ä¸€ä¸ªPythonå‡½æ•°æ¥è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—"
      }
    ],
    "max_tokens": 200,
    "temperature": 0.7
  }'
```

#### 4.2 Pythonå®¢æˆ·ç«¯ç¤ºä¾‹

```python
import requests
import json

# APIé…ç½®
API_BASE = "http://localhost"
API_KEY = "your-api-key"  # å¦‚æœå¯ç”¨äº†è®¤è¯

def chat_with_deepseek(message):
    url = f"{API_BASE}/v1/chat/completions"
    headers = {
        "Content-Type": "application/json",
        "Authorization": f"Bearer {API_KEY}"  # å¦‚æœéœ€è¦
    }
    
    data = {
        "model": "deepseek-coder",
        "messages": [
            {"role": "user", "content": message}
        ],
        "max_tokens": 200,
        "temperature": 0.7
    }
    
    response = requests.post(url, headers=headers, json=data)
    return response.json()

# ä½¿ç”¨ç¤ºä¾‹
result = chat_with_deepseek("å†™ä¸€ä¸ªå¿«é€Ÿæ’åºç®—æ³•")
print(json.dumps(result, indent=2, ensure_ascii=False))
```

#### 4.3 JavaScriptå®¢æˆ·ç«¯ç¤ºä¾‹

```javascript
async function chatWithDeepSeek(message) {
    const response = await fetch('http://localhost/v1/chat/completions', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            // 'Authorization': 'Bearer your-api-key'  // å¦‚æœéœ€è¦
        },
        body: JSON.stringify({
            model: 'deepseek-coder',
            messages: [
                { role: 'user', content: message }
            ],
            max_tokens: 200,
            temperature: 0.7
        })
    });
    
    return await response.json();
}

// ä½¿ç”¨ç¤ºä¾‹
chatWithDeepSeek('è§£é‡Šä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ')
    .then(result => console.log(result))
    .catch(error => console.error(error));
```

### 5. å¸¸ç”¨ç®¡ç†å‘½ä»¤

#### 5.1 æœåŠ¡ç®¡ç†

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./scripts/03-monitor-service.sh status

# é‡å¯æ‰€æœ‰æœåŠ¡
./scripts/03-monitor-service.sh restart

# é‡å¯ç‰¹å®šç»„ä»¶
./scripts/03-monitor-service.sh restart master

# åœæ­¢æœåŠ¡
./scripts/03-monitor-service.sh stop

# å¯åŠ¨æœåŠ¡
./scripts/03-monitor-service.sh start
```

#### 5.2 æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
./scripts/03-monitor-service.sh logs

# æŸ¥çœ‹ç‰¹å®šç»„ä»¶æ—¥å¿—
./scripts/03-monitor-service.sh logs master 100

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

#### 5.3 æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½
./scripts/03-monitor-service.sh monitor

# æŸ¥çœ‹æœåŠ¡æŒ‡æ ‡
./scripts/03-monitor-service.sh metrics

# ç”ŸæˆçŠ¶æ€æŠ¥å‘Š
./scripts/03-monitor-service.sh report
```

#### 5.4 æœåŠ¡ç¼©æ”¾

```bash
# æ‰©å±•åˆ°3ä¸ªå·¥ä½œèŠ‚ç‚¹
./scripts/03-monitor-service.sh scale 3

# ç¼©å‡åˆ°1ä¸ªå·¥ä½œèŠ‚ç‚¹
./scripts/03-monitor-service.sh scale 1
```

### 6. æ•…éšœæ’é™¤

#### 6.1 å¸¸è§é—®é¢˜

**é—®é¢˜1: æ¨¡å‹ä¸‹è½½å¤±è´¥**

```bash
# è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨ä»£ç†æˆ–æ›´æ¢ä¸‹è½½æº
export HF_ENDPOINT=https://hf-mirror.com
./scripts/02-deploy-model.sh
```

**é—®é¢˜2: GPUæœªè¢«è¯†åˆ«**

```bash
# æ£€æŸ¥NVIDIAé©±åŠ¨
nvidia-smi

# æ£€æŸ¥Docker GPUæ”¯æŒ
docker run --rm --gpus all nvidia/cuda:11.0-base nvidia-smi
```

**é—®é¢˜3: ç«¯å£è¢«å ç”¨**

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tuln | grep :8000

# åœæ­¢å ç”¨è¿›ç¨‹
sudo fuser -k 8000/tcp
```

**é—®é¢˜4: å†…å­˜ä¸è¶³**

```bash
# è°ƒæ•´æ¨¡å‹é…ç½®ï¼Œå‡å°‘GPUå†…å­˜ä½¿ç”¨
export GPU_MEMORY_UTILIZATION=0.7
./scripts/02-deploy-model.sh
```

#### 6.2 æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
./scripts/03-monitor-service.sh logs all 200 | grep -i error

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
docker-compose logs deepseek-master | head -50

# æŸ¥çœ‹APIè®¿é—®æ—¥å¿—
tail -f /data/logs/api.log
```

#### 6.3 æ€§èƒ½è°ƒä¼˜

**å†…å­˜ä¼˜åŒ–**:

```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim api/config/settings.py

# è°ƒæ•´ä»¥ä¸‹å‚æ•°
MAX_BATCH_SIZE = 4  # å‡å°‘æ‰¹å¤„ç†å¤§å°
GPU_MEMORY_UTILIZATION = 0.8  # è°ƒæ•´GPUå†…å­˜ä½¿ç”¨ç‡
```

**å¹¶å‘ä¼˜åŒ–**:

```bash
# å¢åŠ å·¥ä½œè¿›ç¨‹æ•°
export WORKER_PROCESSES=4
docker-compose up -d
```

### 7. é«˜çº§é…ç½®

#### 7.1 é›†ç¾¤éƒ¨ç½²

```bash
# åœ¨å¤šå°æœåŠ¡å™¨ä¸Šéƒ¨ç½²
# æœåŠ¡å™¨1 (ä¸»èŠ‚ç‚¹)
./scripts/02-deploy-model.sh --type k8s

# æœåŠ¡å™¨2-N (å·¥ä½œèŠ‚ç‚¹)
kubectl join <master-ip>:6443 --token <token>
```

#### 7.2 è´Ÿè½½å‡è¡¡é…ç½®

ç¼–è¾‘ `nginx.conf`:

```nginx
upstream deepseek_backend {
    least_conn;
    server deepseek-master:8000 weight=3;
    server deepseek-worker1:8000 weight=2;
    server deepseek-worker2:8000 weight=1;
    # æ·»åŠ æ›´å¤šå·¥ä½œèŠ‚ç‚¹
    server deepseek-worker3:8000 weight=1;
}
```

#### 7.3 ç›‘æ§é…ç½®

å¯ç”¨Prometheusç›‘æ§:

```bash
# å¯åŠ¨ç›‘æ§æ ˆ
docker-compose -f docker-compose.monitoring.yml up -d

# è®¿é—®Grafanaä»ªè¡¨æ¿
open http://localhost:3000
```

### 8. ç”Ÿäº§ç¯å¢ƒå»ºè®®

#### 8.1 å®‰å…¨é…ç½®

1. **å¯ç”¨APIè®¤è¯**:

```python
# åœ¨settings.pyä¸­é…ç½®
API_KEY_REQUIRED = True
API_KEYS = ["your-secure-api-key"]
```

2. **é…ç½®HTTPS**:

```bash
# ä½¿ç”¨Let's Encrypt
sudo apt install certbot
sudo certbot --nginx -d your-domain.com
```

3. **ç½‘ç»œå®‰å…¨**:

```bash
# é…ç½®é˜²ç«å¢™
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

#### 8.2 å¤‡ä»½ç­–ç•¥

```bash
# å®šæœŸå¤‡ä»½é…ç½®
./scripts/03-monitor-service.sh backup

# è®¾ç½®å®šæ—¶ä»»åŠ¡
echo "0 2 * * * /path/to/scripts/03-monitor-service.sh backup" | crontab -
```

#### 8.3 ç›‘æ§å‘Šè­¦

é…ç½®ç›‘æ§å‘Šè­¦:

```yaml
# alertmanager.yml
route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'web.hook'

receivers:
- name: 'web.hook'
  webhook_configs:
  - url: 'http://localhost:5001/webhook'
```

### 9. æˆæœ¬ä¼˜åŒ–

#### 9.1 åä¸ºäº‘æˆæœ¬æ§åˆ¶

1. **ä½¿ç”¨ç«ä»·å®ä¾‹**:
   - å¼€å‘æµ‹è¯•ç¯å¢ƒä½¿ç”¨ç«ä»·å®ä¾‹å¯èŠ‚çœ70%æˆæœ¬
   - è®¾ç½®è‡ªåŠ¨å¤‡ä»½ï¼Œé¿å…æ•°æ®ä¸¢å¤±

2. **å¼¹æ€§ä¼¸ç¼©**:
   - é…ç½®åŸºäºè´Ÿè½½çš„è‡ªåŠ¨æ‰©ç¼©å®¹
   - éå·¥ä½œæ—¶é—´è‡ªåŠ¨ç¼©å‡å®ä¾‹

3. **å­˜å‚¨ä¼˜åŒ–**:
   - ä½¿ç”¨å¯¹è±¡å­˜å‚¨OBSå­˜æ”¾æ¨¡å‹æ–‡ä»¶
   - å®šæœŸæ¸…ç†æ—¥å¿—å’Œç¼“å­˜æ–‡ä»¶

#### 9.2 èµ„æºä½¿ç”¨ä¼˜åŒ–

```bash
# å¯ç”¨æ··åˆç²¾åº¦æ¨ç†
export USE_MIXED_PRECISION=true

# å¯ç”¨æ¨¡å‹é‡åŒ–
export MODEL_QUANTIZATION=int8

# åŠ¨æ€æ‰¹å¤„ç†
export DYNAMIC_BATCHING=true
```

### 10. ä¸‹ä¸€æ­¥

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š

1. **é›†æˆåˆ°åº”ç”¨**: å°†APIé›†æˆåˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­
2. **å®šåˆ¶æ¨¡å‹**: ä½¿ç”¨è‡ªå·±çš„æ•°æ®å¾®è°ƒæ¨¡å‹
3. **æ‰©å±•åŠŸèƒ½**: æ·»åŠ æ›´å¤šAIåŠŸèƒ½æ¨¡å—
4. **ä¼˜åŒ–æ€§èƒ½**: æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒä¼˜é…ç½®

### 11. è·å–å¸®åŠ©

- **æŸ¥çœ‹æ–‡æ¡£**: `docs/` ç›®å½•ä¸‹çš„è¯¦ç»†æ–‡æ¡£
- **è¿è¡Œç¤ºä¾‹**: `examples/` ç›®å½•ä¸‹çš„ä½¿ç”¨ç¤ºä¾‹
- **é—®é¢˜åé¦ˆ**: é€šè¿‡GitHub IssuesæŠ¥å‘Šé—®é¢˜
- **ç¤¾åŒºæ”¯æŒ**: åŠ å…¥æŠ€æœ¯äº¤æµç¾¤

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœæ‚¨åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹æ•…éšœæ’é™¤éƒ¨åˆ†
2. è¿è¡Œè¯Šæ–­è„šæœ¬: `./scripts/03-monitor-service.sh report`
3. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—: `./scripts/03-monitor-service.sh logs all 500`
4. è”ç³»æŠ€æœ¯æ”¯æŒ

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰
